resource "elasticstack_elasticsearch_index_template" "main" {
  for_each = { for i, v in local.index_templates : v.name => v }

  name = each.value.name

  index_patterns = each.value.index_patterns
  composed_of    = each.value.composed_of

  dynamic "data_stream" {
    for_each = try(each.value.data_stream, null) != null ? [each.value.data_stream] : []

    content {}
  }

  depends_on = [
  {% for k, v in elasticsearch.component_template.items() %}
    elasticstack_elasticsearch_component_template.main["{{ k }}"],
  {% endfor %}
  ]
}
