locals {
  index_templates = [
  {% for k, v in elasticsearch.index_template.items() %}
    {
      name = "{{ k }}"

      {% if v.index_patterns != null %}
      index_patterns = {{ v.index_patterns | tojson }}
      {% endif %}

      {% if v.data_stream != null %}
      data_stream = {
        {% if v.data_stream.allow_custom_routing != null %}allow_custom_routing = {{ v.data_stream.allow_custom_routing }}{% endif %}
        {% if v.data_stream.hidden != null %}hidden = {{ v.data_stream.hidden }}{% endif %}
      }
      {% endif %}

      {% if v.composed_of != null %}
      composed_of = {{ v.composed_of | tojson }}
      {% endif %}
    }
  {% endfor %}
  ]
}

# output "index_templates" {
#   value = local.index_templates
# }
